version: 2

models:
  - name: dim_customers
    description: >
      Canonical customer dimension built from silver.stg_customers.
      Removes everything after the substring "Furchild:" in names (case-insensitive),
      trims leftover separators, and removes "+" from the chosen phone number.
      Deduplicated by CUSTOMER_ID with the most recently updated record winning.

    columns:
      - name: customer_key
        description: Surrogate key generated from CUSTOMER_ID.
        tests:
          - not_null
          - unique

      - name: customer_id
        description: Raw customer identifier from source.
        tests:
          - not_null

      - name: email
        description: Preferred email (EMAIL_PRIMARY else EMAIL_OTHER), lowercased and trimmed.

      - name: phone
        description: Preferred phone (PRIMARY → SECONDARY → FORMATTED) with '+' removed.

      - name: full_name
        description: Customer name cleaned to remove everything after 'Furchild:', then trimmed of trailing separators.

      - name: created_at
        description: Source-created timestamp.

      - name: updated_at
        description: Source-updated timestamp.
